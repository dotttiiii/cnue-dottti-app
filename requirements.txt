streamlit# ...existing code...
import streamlit as st
import random
from typing import List, Tuple

st.set_page_config(page_title="ê³±ì…ˆ í€´ì¦ˆ", layout="centered")

def generate_questions(count: int, max_factor: int) -> List[Tuple[int, int, int]]:
    return [(random.randint(1, max_factor), random.randint(1, max_factor), 0) for _ in range(count)]

def start_quiz(num_q: int, max_factor: int):
    qs = generate_questions(num_q, max_factor)
    qs = [(a, b, a*b) for (a, b, _) in qs]
    st.session_state.questions = qs
    st.session_state.index = 0
    st.session_state.score = 0
    st.session_state.history = []
    st.session_state.started = True
    st.session_state.user_answer = None

if "started" not in st.session_state:
    st.session_state.started = False

st.title("ğŸ§® ê³±ì…ˆ í€´ì¦ˆ")
st.write("ê°„ë‹¨í•œ ê³±ì…ˆ ë¬¸ì œë¡œ ì‹¤ë ¥ì„ í™•ì¸í•˜ì„¸ìš”. ì‚¬ì´ë“œë°”ì—ì„œ ì„¤ì • í›„ ì‹œì‘í•˜ì„¸ìš”.")

# Sidebar: ì„¤ì •
with st.sidebar:
    st.header("ì„¤ì •")
    num_questions = st.slider("ë¬¸ì œ ìˆ˜", min_value=5, max_value=30, value=10, step=1)
    max_factor = st.selectbox("ìµœëŒ€ ê³±ì…ˆ ê°’", options=[5, 9, 12, 19, 99], index=1, format_func=lambda x: f"1~{x}")
    if st.button("í€´ì¦ˆ ì‹œì‘"):
        start_quiz(num_questions, max_factor)
    if st.button("ì´ˆê¸°í™”"):
        st.session_state.started = False
        st.session_state.questions = []
        st.session_state.index = 0
        st.session_state.score = 0
        st.session_state.history = []
        st.session_state.user_answer = None
        st.success("ì´ˆê¸°í™” ì™„ë£Œ")

# Main UI
if not st.session_state.started:
    st.info("ì‚¬ì´ë“œë°”ì—ì„œ ë¬¸ì œ ìˆ˜ì™€ ë²”ìœ„ë¥¼ ì •í•œ ë’¤ 'í€´ì¦ˆ ì‹œì‘'ì„ ëˆ„ë¥´ì„¸ìš”.")
else:
    qs = st.session_state.questions
    idx = st.session_state.index
    total = len(qs)

    if idx >= total:
        st.subheader("í€´ì¦ˆ ì™„ë£Œ ğŸ‰")
        st.write(f"ì ìˆ˜: {st.session_state.score} / {total}")
        if st.session_state.history:
            st.subheader("ìƒì„¸ ê²°ê³¼")
            for i, entry in enumerate(st.session_state.history, start=1):
                st.write(f"{i}. {entry}")
        if st.button("ë‹¤ì‹œ í’€ê¸°"):
            start_quiz(total, max_factor)
    else:
        a, b, ans = qs[idx]
        st.metric("ì§„í–‰", f"{idx+1} / {total}")
        st.subheader(f"ë¬¸ì œ {idx+1}")
        st.write(f"{a} Ã— {b} = ?")

        with st.form(key=f"answer_form_{idx}", clear_on_submit=True):
            user = st.number_input("ì •ë‹µì„ ìˆ«ìë¡œ ì…ë ¥í•˜ì„¸ìš”", min_value=-10**9, max_value=10**9, value=0, step=1)
            submitted = st.form_submit_button("ì œì¶œ")
            if submitted:
                correct = (user == ans)
                if correct:
                    st.session_state.score += 1
                    st.success("ì •ë‹µ!")
                else:
                    st.error(f"ì˜¤ë‹µ. ì •ë‹µì€ {ans} ì…ë‹ˆë‹¤.")
                st.session_state.history.insert(0, f"{a}Ã—{b} = {ans} â€” ì…ë ¥: {user} â€” {'ì •ë‹µ' if correct else 'ì˜¤ë‹µ'}")
                st.session_state.index += 1

        if st.button("ì •ë‹µ ë³´ê¸°"):
            st.info(f"ì •ë‹µ: {ans}")

    # í•˜ë‹¨ì— ìš”ì•½
    st.write("---")
    st.write(f"í˜„ì¬ ì ìˆ˜: {st.session_state.score} / {total}")
    if st.session_state.history:
        st.subheader("ìµœê·¼ ê¸°ë¡")
        for entry in st.session_state.history[:8]:
            st.write(entry)
# ...existing code...